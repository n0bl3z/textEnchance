// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π JavaScript –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã —Å —Ñ–∏–∫—Å–æ–º –ø–æ–ª–µ–π –≤–≤–æ–¥–∞

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
function toggleTheme() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º Tailwind –∫–ª–∞—Å—Å—ã
    updateTailwindClasses(newTheme);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    showNotification(
        newTheme === 'dark' ? 'üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞' : '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞',
        'success'
    );
}

// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤
function updateTailwindClasses(theme) {
    const body = document.body;
    
    if (theme === 'dark') {
        // –û–±–Ω–æ–≤–ª—è–µ–º body
        body.classList.remove('bg-gray-50');
        body.classList.add('bg-slate-900');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        updateClasses('.bg-white', ['bg-white'], ['bg-slate-800']);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
        updateClasses('.border-gray-200', ['border-gray-200'], ['border-slate-700']);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
        updateClasses('.text-gray-900', ['text-gray-900'], ['text-slate-100']);
        updateClasses('.text-gray-700', ['text-gray-700'], ['text-slate-300']);
        updateClasses('.text-gray-500', ['text-gray-500'], ['text-slate-400']);
        updateClasses('.text-gray-600', ['text-gray-600'], ['text-slate-400']);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ–Ω—ã —Ç–∞–±–ª–∏—Ü –∏ —Å–µ–∫—Ü–∏–π
        updateClasses('.bg-gray-50', ['bg-gray-50'], ['bg-slate-800']);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º hover —Å–æ—Å—Ç–æ—è–Ω–∏—è
        updateClasses('[class*="hover:bg-gray-50"]', ['hover:bg-gray-50'], ['hover:bg-slate-700']);
        updateClasses('[class*="hover:bg-red-50"]', ['hover:bg-red-50'], ['hover:bg-red-900']);
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        updateInputFields('dark');
        
    } else {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É
        body.classList.remove('bg-slate-900');
        body.classList.add('bg-gray-50');
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –æ–±—Ä–∞—Ç–Ω–æ
        updateClasses('.bg-slate-800', ['bg-slate-800'], ['bg-white']);
        updateClasses('.border-slate-700', ['border-slate-700'], ['border-gray-200']);
        updateClasses('.border-slate-600', ['border-slate-600'], ['border-gray-300']);
        updateClasses('.text-slate-100', ['text-slate-100'], ['text-gray-900']);
        updateClasses('.text-slate-300', ['text-slate-300'], ['text-gray-700']);
        updateClasses('.text-slate-400', ['text-slate-400'], ['text-gray-500']);
        updateClasses('[class*="hover:bg-slate-700"]', ['hover:bg-slate-700'], ['hover:bg-gray-50']);
        updateClasses('[class*="hover:bg-red-900"]', ['hover:bg-red-900'], ['hover:bg-red-50']);
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã
        updateInputFields('light');
    }
}

// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
function updateInputFields(theme) {
    const inputs = document.querySelectorAll('input[type="text"], textarea, #tags, #inputData');
    
    inputs.forEach(input => {
        if (theme === 'dark') {
            // –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏
            input.style.setProperty('background-color', '#1e293b', 'important');
            input.style.setProperty('color', '#f1f5f9', 'important');
            input.style.setProperty('border-color', '#475569', 'important');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º Tailwind –∫–ª–∞—Å—Å—ã
            input.classList.remove('bg-white', 'text-gray-900', 'border-gray-300');
            input.classList.add('bg-slate-800', 'text-slate-100', 'border-slate-600');
            
        } else {
            // –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
            input.style.setProperty('background-color', '#ffffff', 'important');
            input.style.setProperty('color', '#1f2937', 'important');
            input.style.setProperty('border-color', '#d1d5db', 'important');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º Tailwind –∫–ª–∞—Å—Å—ã
            input.classList.remove('bg-slate-800', 'text-slate-100', 'border-slate-600');
            input.classList.add('bg-white', 'text-gray-900', 'border-gray-300');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º placeholder
        if (theme === 'dark') {
            input.style.setProperty('--tw-placeholder-color', '#94a3b8', 'important');
        } else {
            input.style.setProperty('--tw-placeholder-color', '#9ca3af', 'important');
        }
    });
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º focus —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const style = document.createElement('style');
    style.id = 'dynamic-input-styles';
    
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
    const existingStyle = document.getElementById('dynamic-input-styles');
    if (existingStyle) {
        existingStyle.remove();
    }
    
    if (theme === 'dark') {
        style.textContent = `
            [data-theme="dark"] input[type="text"]:focus,
            [data-theme="dark"] textarea:focus {
                background-color: #1e293b !important;
                color: #f1f5f9 !important;
                border-color: #0ea5e9 !important;
            }
            [data-theme="dark"] input[type="text"]::placeholder,
            [data-theme="dark"] textarea::placeholder {
                color: #94a3b8 !important;
            }
        `;
    } else {
        style.textContent = `
            input[type="text"]:focus,
            textarea:focus {
                background-color: #ffffff !important;
                color: #1f2937 !important;
                border-color: #0ea5e9 !important;
            }
            input[type="text"]::placeholder,
            textarea::placeholder {
                color: #9ca3af !important;
            }
        `;
    }
    
    document.head.appendChild(style);
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤
function updateClasses(selector, removeClasses, addClasses) {
    try {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–∞—Å—Å—ã
            removeClasses.forEach(cls => {
                if (element.classList.contains(cls.replace(':', '\\:'))) {
                    element.classList.remove(cls);
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
            addClasses.forEach(cls => {
                element.classList.add(cls);
            });
        });
    } catch (error) {
        console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–ª–∞—Å—Å–æ–≤:', selector, error);
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'info') {
    // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const existing = document.querySelector('.notification');
    if (existing) {
        existing.remove();
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 3000);
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à
function showKeyboardShortcuts() {
    showNotification('‚å®Ô∏è Ctrl+Enter: –û–±—Ä–∞–±–æ—Ç–∞—Ç—å | Ctrl+L: –ü—Ä–∏–º–µ—Ä | Ctrl+Shift+D: –¢–µ–º–∞', 'info');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
function initTheme() {
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = savedTheme || (prefersDark ? 'dark' : 'light');
    
    document.documentElement.setAttribute('data-theme', theme);
    updateTailwindClasses(theme);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
document.addEventListener('keydown', function(e) {
    // Ctrl + Shift + D - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
        e.preventDefault();
        toggleTheme();
    }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    initTheme();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    setTimeout(() => {
        document.body.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const style = document.createElement('style');
        style.textContent = `
            * {
                transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease !important;
            }
        `;
        document.head.appendChild(style);
    }, 100);
});

// –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
    if (!localStorage.getItem('theme')) {
        const theme = e.matches ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
        updateTailwindClasses(theme);
    }
});

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
function fixSpecificElements() {
    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    const statsCards = document.querySelectorAll('.stats-card');
    const theme = document.documentElement.getAttribute('data-theme');
    
    statsCards.forEach(card => {
        if (theme === 'dark') {
            card.style.background = 'linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary))';
        } else {
            card.style.background = 'linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary))';
        }
    });
    
    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
    const table = document.getElementById('previewTable');
    if (table) {
        const thead = table.querySelector('thead');
        const tbody = table.querySelector('tbody');
        
        if (theme === 'dark') {
            if (thead) thead.style.backgroundColor = 'var(--bg-tertiary)';
            if (tbody) tbody.style.backgroundColor = 'var(--bg-secondary)';
        } else {
            if (thead) thead.style.backgroundColor = '';
            if (tbody) tbody.style.backgroundColor = '';
        }
    }
}

// –í—ã–∑—ã–≤–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
const originalToggleTheme = toggleTheme;
toggleTheme = function() {
    originalToggleTheme();
    setTimeout(fixSpecificElements, 50);
    setTimeout(() => updateInputFields(document.documentElement.getAttribute('data-theme')), 100);
};